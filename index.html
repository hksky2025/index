<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chengdu Chongqing Trip 2024</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'snow-white': '#F9FAFB',
                        'ice-blue': '#E0F2FE',
                        'light-snow-blue': '#F0F9FF',
                        'deep-sea-blue': '#0369A1',
                        'accent-yellow': '#FBBF24',
                        'spicy-red': '#DC2626',
                        'soft-gray': '#F3F4F6'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            background-color: #F0F9FF;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans TC', sans-serif;
            color: #334155;
        }
        
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #ffffff;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
            position: relative;
            padding-bottom: 90px;
        }
        
        .header-bg {
            background-color: #ffffff;
            padding: 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        
        .header-image-container {
            width: 100%;
            height: 250px;
            overflow: hidden;
            background-color: #0c4a6e;
            border-bottom-left-radius: 35px;
            border-bottom-right-radius: 35px;
            position: relative;
        }
        
        .header-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            opacity: 0.9;
        }
        
        .snow-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 100 100'><circle cx='50' cy='50' r='1' fill='%2323ffff' opacity='0.8'/><circle cx='20' cy='80' r='0.5' fill='%2323ffff' opacity='0.6'/><circle cx='70' cy='30' r='1.5' fill='%2323ffff' opacity='0.9'/></svg>");
            background-size: 100px 100px;
            opacity: 0.5;
            animation: snowfall 10s linear infinite;
            z-index: 5;
        }
        
        @keyframes snowfall {
            to {
                background-position: 100px 100px;
            }
        }
        
        .side-tab-bar {
            position: absolute;
            bottom: 45px;
            right: 16px;
            z-index: 30;
            display: flex;
            flex-direction: row;
            gap: 8px;
        }
        
        .tab-button {
            width: 40px;
            height: 40px;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            background-color: #0369A1;
            color: #ffffff;
            box-shadow: 0 6px 15px rgba(3, 105, 161, 0.4);
            transform: scale(1.05);
        }
        
        .tab-button:not(.active) {
            background-color: #ffffff;
            color: #7DD3FC;
        }
        
        .app-main {
            padding-top: 25px !important;
            position: relative;
            z-index: 5;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .card-shadow {
            box-shadow: 0 4px 20px rgba(186, 230, 253, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0px);
            }
        }
        
        .fab-shadow {
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.5);
        }
        
        .note-content {
            max-height: 2.5rem;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            line-height: 1.6;
            font-size: 0.9rem;
        }
        
        .note-content b, .note-content strong {
            font-weight: 800;
        }
        
        .note-content u {
            text-decoration: underline;
        }
        
        .note-content.fontsize1 {
            font-size: 0.75rem;
        }
        
        .note-content.fontsize3 {
            font-size: 1rem;
        }
        
        .note-content.fontsize5 {
            font-size: 1.25rem;
            line-height: 1.2;
            font-weight: bold;
        }
        
        .note-content.expanded {
            max-height: 1000px;
        }
        
        .expense-category-tag {
            min-width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .expenses-banner {
            background: linear-gradient(135deg, #BE123C 0%, #FB7185 100%);
        }
        
        .date-selector-sticky {
            background-color: #ffffff;
            border-bottom: 1px solid #f0f0f0;
            z-index: 20;
            top: 0;
        }
        
        /* 增強文字轉色功能 */
        .rich-editor-toolbar {
            padding: 8px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .rich-editor-toolbar .tool-btn {
            padding: 4px 8px;
            border-radius: 6px;
            margin-right: 2px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            color: #475569;
            font-size: 12px;
            transition: all 0.2s;
            height: 28px;
            min-width: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .rich-editor-toolbar .tool-btn:hover {
            background: #e2e8f0;
            color: #0369A1;
        }
        
        .color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.1s;
            display: inline-block;
            margin: 1px;
        }
        
        .color-dot:hover {
            transform: scale(1.2);
            border-color: rgba(0,0,0,0.3);
        }
        
        .rich-editor-content {
            min-height: 120px;
            max-height: 250px;
            overflow-y: auto;
            outline: none;
            word-wrap: break-word;
            padding: 12px;
            background: #fff;
        }
        
        .rich-editor-content b {
            font-weight: bold;
        }
        
        .color-picker-modal {
            position: fixed;
            inset: 0;
            background: rgba(3, 105, 161, 0.4);
            z-index: 60;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-blur: sm;
        }
        
        .color-picker-container {
            background: white;
            border-radius: 20px;
            padding: 24px;
            max-width: 90vw;
            max-height: 80vh;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
        }
        
        .color-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            margin: 16px 0;
        }
        
        .custom-color-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            margin: 8px 0;
        }
        
        .preview-color {
            width: 100%;
            height: 60px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <!-- Header -->
        <div class="header-bg relative">
            <div class="header-image-container">
                <img src="https://images.unsplash.com/photo-1542036647-794d0752d580?q=80&w=1000&auto=format&fit=crop" alt="">
                <div class="snow-layer"></div>
            </div>
            <div class="side-tab-bar">
                <button @click="currentTab = 'itinerary'" :class="['tab-button', { active: currentTab === 'itinerary' }]">
                    <i class="fa-solid fa-map-location-dot"></i>
                </button>
                <button @click="currentTab = 'info'" :class="['tab-button', { active: currentTab === 'info' }]">
                    <i class="fa-solid fa-circle-info"></i>
                </button>
                <button @click="currentTab = 'shopping'" :class="['tab-button', { active: currentTab === 'shopping' }]">
                    <i class="fa-solid fa-basket-shopping"></i>
                </button>
                <button @click="currentTab = 'expenses'" :class="['tab-button', { active: currentTab === 'expenses' }]">
                    <i class="fa-solid fa-coins"></i>
                </button>
            </div>
        </div>

        <div class="main p-4 app-main">
            <!-- Itinerary Tab -->
            <div v-if="currentTab === 'itinerary'" class="animate-fade-in">
                <!-- Date Selector -->
                <div class="flex overflow-x-auto hide-scrollbar space-x-3 pb-4 mb-2 snap-x px-1 sticky date-selector-sticky pt-1 -mx-4 px-4">
                    <div v-for="(day, index) in dates" :key="index" @click="selectedDateIndex = index"
                         :class="['snap-center flex-shrink-0 w-[58px] h-[68px] rounded-xl flex flex-col items-center justify-center cursor-pointer transition-all duration-300 border-2 shadow-sm',
                                  { 'bg-deep-sea-blue text-white border-deep-sea-blue shadow-lg scale-105': selectedDateIndex === index },
                                  { 'bg-white text-slate-400 border-white hover:bg-soft-gray': selectedDateIndex !== index }]">
                        <span class="text-sm font-bold uppercase tracking-wider">{{ day.weekday }}</span>
                        <span class="text-xs font-medium opacity-70">{{ day.date }}</span>
                    </div>
                </div>

                <!-- Weather -->
                <div v-if="weatherData[selectedDateIndex]" class="mb-4 bg-snow-white border border-ice-blue rounded-2xl p-4 flex justify-between items-center shadow-md">
                    <div class="flex items-start text-deep-sea-blue space-x-4">
                        <i :class="getWeatherIcon(weatherData[selectedDateIndex].condition)" class="text-5xl text-blue-500"></i>
                        <div class="pt-1">
                            <span class="text-3xl font-extrabold leading-none">{{ weatherData[selectedDateIndex].temp.split('/')[0] }}</span>
                            <span class="text-sm font-light text-slate-500 ml-1">{{ weatherData[selectedDateIndex].temp.split('/')[1] }}°C</span>
                            <span class="block text-xs text-slate-600 mt-1">{{ weatherData[selectedDateIndex].feel }}°C</span>
                        </div>
                    </div>
                    <div class="text-right text-xs text-slate-600 pl-3">
                        <span class="font-bold block text-slate-700">{{ getWeatherDescription(weatherData[selectedDateIndex].condition) }}</span>
                        <span v-if="dates[selectedDateIndex].hasTrain" class="mt-1 block text-deep-sea-blue font-bold">
                            <i class="fa-solid fa-train mr-1 text-accent-yellow"></i>高鐵移動日
                        </span>
                        <span v-else class="mt-1 block text-slate-400">本日市區遊覽</span>
                    </div>
                </div>

                <!-- Itinerary Items -->
                <div class="space-y-4">
                    <div v-for="(item, idx) in currentItinerary" :key="item.id" class="relative group">
                        <!-- Timeline Line -->
                        <div v-if="idx > 0" class="pl-8 pb-2 flex items-center text-xs text-slate-400">
                            <div class="h-6 w-0.5 bg-slate-200 absolute left-6 -top-3"></div>
                            <i :class="getTransportIcon(currentItinerary[idx].transportType)" class="mr-2 text-slate-300 cursor-pointer hover:text-deep-sea-blue transition-colors" @click="openMapDirections(currentItinerary[idx-1], item)"></i>
                            <span class="font-bold">{{ item.travelTime }}</span>
                        </div>

                        <!-- Item Card -->
                        <div class="bg-white rounded-3xl p-5 card-shadow relative overflow-hidden flex items-start border border-ice-blue/50">
                            <div class="mr-4 flex flex-col items-center min-w-[50px]">
                                <div class="p-2 rounded-full text-white shadow-md text-base mb-1" :style="'background-color: ' + getCategoryColor(item.category)">
                                    <i :class="getCategoryIcon(item.category)"></i>
                                </div>
                                <span v-if="item.startTime" class="text-xs font-bold text-slate-600 mt-1">{{ item.startTime }}</span>
                            </div>
                            <div class="flex-1 pb-1">
                                <h3 class="text-lg font-bold text-slate-800 mb-1 leading-tight pr-8">{{ item.name }}</h3>
                                <div class="text-sm text-slate-500 space-y-1.5 mt-2">
                                    <p v-if="item.hours" class="flex items-center">
                                        <i class="fa-regular fa-clock w-4 text-center mr-2 text-ice-blue"></i>{{ item.hours }}
                                    </p>
                                    <p v-if="item.price" class="flex items-center">
                                        <i class="fa-solid fa-ticket w-4 text-center mr-2 text-ice-blue"></i>{{ item.price }}
                                    </p>
                                    <p v-if="item.address" class="flex items-start">
                                        <i class="fa-solid fa-location-dot w-4 text-center mr-2 mt-1 text-ice-blue"></i>{{ item.address }}
                                    </p>
                                </div>
                            </div>

                            <!-- Note -->
                            <div v-if="item.note && item.note.length > 0" class="mt-3 text-xs bg-slate-50 p-2.5 rounded-lg border border-slate-100">
                                <p class="text-slate-600 font-bold mb-1 flex items-center">
                                    <i class="fa-solid fa-highlighter text-accent-yellow mr-2"></i>備註
                                </p>
                                <div class="note-content" :class="{ expanded: item.isNoteExpanded }" v-html="formatNoteDisplay(item.note)"></div>
                                <button v-if="item.note.length > 50 || item.note.includes('<')" @click="item.isNoteExpanded = !item.isNoteExpanded"
                                        class="text-deep-sea-blue font-bold mt-1 block">
                                    {{ item.isNoteExpanded ? '收合' : '展開' }}
                                </button>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="absolute top-3 right-3 flex flex-col space-y-1">
                            <button v-if="idx > 0" @click.stop="moveItineraryUp(item.id)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-300 transition-colors" title="上移">
                                <i class="fa-solid fa-arrow-up"></i>
                            </button>
                            <button v-if="idx < currentItinerary.length - 1" @click.stop="moveItineraryDown(item.id)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-300 transition-colors" title="下移">
                                <i class="fa-solid fa-arrow-down"></i>
                            </button>
                            <button @click.stop="openMap(item.address, item.name)" class="w-7 h-7 bg-ice-blue text-deep-sea-blue rounded-full flex items-center justify-center text-xs hover:bg-deep-sea-blue hover:text-white transition-colors" title="Google Maps">
                                <i class="fa-solid fa-location-arrow"></i>
                            </button>
                            <button @click.stop="editItem(item)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-200 transition-colors" title="編輯">
                                <i class="fa-solid fa-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div v-if="currentItinerary.length === 0" class="text-center py-16 text-slate-300">
                    <i class="fa-solid fa-map-location-dot text-5xl mb-3 text-slate-200"></i>
                    <p class="text-sm"><br>本日尚無行程<br>請點擊右下角新增</p>
                </div>
            </div>

            <!-- Info Tab -->
            <div v-if="currentTab === 'info'" class="space-y-5 animate-fade-in">
                <!-- Currency Converter -->
                <div class="bg-gradient-to-r from-red-700 to-red-500 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-10 -mt-10 blur-2xl"></div>
                    <div class="absolute bottom-0 left-0 w-32 h-32 bg-white/10 rounded-full -ml-10 -mb-10 blur-2xl"></div>
                    <h3 class="font-bold text-lg mb-4 flex items-center relative z-10">
                        <i class="fa-solid fa-calculator mr-2"></i>匯率換算
                    </h3>
                    <div class="flex items-center justify-between space-x-3 relative z-10">
                        <div class="flex-1">
                            <label class="text-10px text-red-200 block mb-1 uppercase tracking-wider">CNY</label>
                            <input type="number" v-model="currencyInput" @input="calculateCurrency" class="w-full bg-white/20 border border-white/30 rounded-xl px-3 py-2.5 text-white placeholder-white/50 focus:outline-none focus:bg-white/30 text-lg font-bold" placeholder="輸入金額">
                        </div>
                        <i class="fa-solid fa-arrow-right-arrow-left text-red-200 mt-5"></i>
                        <div class="flex-1">
                            <label class="text-10px text-red-200 block mb-1 uppercase tracking-wider">HKD</label>
                            <div class="w-full bg-white/10 rounded-xl px-3 py-2.5 text-white text-lg font-bold border border-transparent">{{ currencyResult }}</div>
                        </div>
                    </div>
                    <p class="text-10px text-red-200 mt-3 text-right relative z-10">預設匯率: {{ exchangeRate }}</p>
                </div>

                <!-- Flights -->
                <div class="bg-white rounded-3xl p-5 card-shadow">
                    <h3 class="font-bold text-slate-800 mb-3 border-b border-slate-100 pb-2">
                        <i class="fa-solid fa-plane-departure text-blue-500 mr-2"></i>航班資訊
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-blue-50 rounded-xl p-3 border border-blue-100">
                            <div class="flex justify-between text-sm font-bold text-deep-sea-blue mb-1">
                                <span>SZX 深圳</span><i class="fa-solid fa-plane text-xs"></i><span>CTU 成都</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>13:45</span><span>CA4340 (12/24)</span><span>16:30</span>
                            </div>
                        </div>
                        <div class="bg-orange-50 rounded-xl p-3 border border-orange-100">
                            <div class="flex justify-between text-sm font-bold text-orange-800 mb-1">
                                <span>CKG 重慶</span><i class="fa-solid fa-plane text-xs"></i><span>SZX 深圳</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>17:30</span><span>CA4340* (1/1)</span><span>19:35</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hotels -->
                <div class="bg-white rounded-3xl p-6 card-shadow">
                    <h3 class="font-bold text-slate-800 mb-4 border-b border-slate-100 pb-3">
                        <i class="fa-solid fa-hotel text-indigo-500 mr-2"></i>住宿資訊
                    </h3>
                    <ul class="space-y-5">
                        <li v-for="hotel in hotels" class="border-b last:border-0 pb-4 last:pb-0">
                            <div class="flex justify-between items-start group">
                                <div class="flex-1">
                                    <span class="font-bold block text-slate-700 text-lg">{{ hotel.name }}</span>
                                    <span class="text-xs text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full inline-block mt-1">{{ hotel.date }}</span>
                                </div>
                                <button @click="openMap(hotel.name)" class="w-8 h-8 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center group-hover:bg-indigo-500 group-hover:text-white transition-all">
                                    <i class="fa-solid fa-location-arrow text-xs"></i>
                                </button>
                            </div>
                            <div class="text-sm text-slate-500 mt-2 space-y-1">
                                <p class="flex items-start">
                                    <i class="fa-solid fa-map-pin w-4 text-center mr-2 mt-1 text-slate-300"></i>{{ hotel.address }}
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Emergency -->
                <div class="bg-red-50 rounded-3xl p-6 border border-red-100">
                    <h3 class="font-bold text-red-800 mb-4">
                        <i class="fa-solid fa-kit-medical mr-2"></i>緊急聯絡
                    </h3>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <a href="tel:110" class="bg-white py-3 rounded-xl shadow-sm text-red-600 font-bold block border border-red-100 hover:bg-red-600 hover:text-white transition-all">
                            <i class="fa-solid fa-user-shield mr-1"></i>110
                        </a>
                        <a href="tel:120" class="bg-white py-3 rounded-xl shadow-sm text-red-600 font-bold block border border-red-100 hover:bg-red-600 hover:text-white transition-all">
                            <i class="fa-solid fa-truck-medical mr-1"></i>120
                        </a>
                    </div>
                    <p class="mt-4 text-xs text-red-500 text-center">大陸110報警，120救護車</p>
                </div>
            </div>

            <!-- Shopping Tab -->
            <div v-if="currentTab === 'shopping'" class="animate-fade-in">
                <div class="grid grid-cols-2 gap-4">
                    <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-2xl p-3 card-shadow relative group">
                        <div class="aspect-square bg-slate-50 rounded-xl mb-3 overflow-hidden relative border border-slate-100">
                            <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                            <div v-else class="w-full h-full flex items-center justify-center text-slate-300">
                                <i class="fa-solid fa-bag-shopping text-3xl"></i>
                            </div>
                        </div>
                        <button @click="removeShoppingItem(idx)" class="absolute top-2 right-2 bg-black/60 text-white rounded-full w-7 h-7 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                        <p class="font-bold text-sm text-slate-800 truncate px-1">{{ item.name }}</p>
                    </div>
                    <div v-if="shoppingList.length % 2 !== 0" class="h-0 invisible"></div>
                </div>
                <div v-if="shoppingList.length === 0" class="col-span-2 text-center py-16 text-slate-300">
                    <i class="fa-solid fa-bag-shopping text-5xl mb-3 text-slate-200"></i>
                    <p class="text-sm"><br>購物清單空白<br>重慶火鍋底料、熊貓週邊...</p>
                </div>
            </div>

            <!-- Expenses Tab -->
            <div v-if="currentTab === 'expenses'" class="animate-fade-in">
                <div class="expenses-banner text-white rounded-3xl p-8 mb-6 relative overflow-hidden">
                    <div class="absolute -right-10 -top-10 bg-white/10 w-48 h-48 rounded-full blur-3xl"></div>
                    <div class="absolute -left-10 -bottom-10 bg-orange-400/20 w-40 h-40 rounded-full blur-2xl"></div>
                    <p class="text-sm text-red-100 mb-2 relative z-10">CNY</p>
                    <h2 class="text-5xl font-bold relative z-10 tracking-tight">{{ formatNumber(totalExpensesCNY) }}</h2>
                    <p class="text-sm text-right mt-2 opacity-80 relative z-10">HK${{ formatNumber(totalExpensesHKD) }}</p>
                </div>

                <div class="bg-white rounded-t-3xl min-h-[500px] p-6 shadow-0-10px-40px-rgba(0,0,0,0.03) -mx-4 px-8">
                    <h3 class="font-bold text-slate-800 mb-5 flex items-center">
                        <i class="fa-solid fa-receipt text-slate-300 mr-2"></i>支出紀錄
                    </h3>
                    <div class="space-y-5">
                        <div v-for="(exp, idx) in expenses" :key="idx" class="flex items-center justify-between border-b border-slate-50 pb-4 last:border-0">
                            <div class="flex items-center">
                                <div class="expense-category-tag mr-4" :style="'background-color: ' + getCategoryColor(exp.category)" text-white>{{ getCategoryLabel(exp.category) }}</div>
                                <div>
                                    <p class="font-bold text-slate-700 text-sm mb-0.5">{{ exp.name }}</p>
                                    <p class="text-10px text-slate-400 uppercase tracking-wide">{{ exp.date }} · {{ exp.payment === 'card' ? '電子支付' : '現金' }}</p>
                                </div>
                            </div>
                            <div class="text-right flex items-center">
                                <p class="font-bold text-slate-700">¥{{ formatNumber(exp.amount) }}</p>
                                <button @click="removeExpense(idx)" class="w-5 h-5 ml-3 text-red-300 hover:text-red-500 transition-colors flex items-center justify-center">
                                    <i class="fa-solid fa-xmark text-lg"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAB Button -->
        <button v-if="currentTab !== 'info'" @click="handleAddClick" class="fixed bottom-6 right-6 w-14 h-14 bg-accent-yellow rounded-full fab-shadow text-white text-2xl flex items-center justify-content center hover:scale-110 transition-transform z-40">
            <i class="fa-solid fa-plus"></i>
        </button>
    </div>

    <!-- Shopping Modal -->
    <div v-if="showShoppingModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
            <h3 class="font-bold text-lg mb-5 text-center text-slate-800">新增購物項目</h3>
            <input v-model="newShoppingItem.name" type="text" placeholder="購物項目名稱" class="w-full bg-slate-50 border-none rounded-xl p-4 mb-4 focus:ring-2 focus:ring-deep-sea-blue text-sm">
            <div class="relative mb-6">
                <input type="file" @change="handleImageUpload" class="hidden" id="fileInput">
                <label for="fileInput" class="w-full h-36 bg-slate-50 border-2 border-dashed border-slate-200 rounded-xl flex items-center justify-center cursor-pointer text-slate-400 hover:bg-slate-100 hover:border-slate-300 transition-all">
                    <span v-if="!newShoppingItem.image" class="flex flex-col items-center text-xs">
                        <i class="fa-solid fa-camera text-2xl mb-2"></i>
                        <span>點擊上傳圖片</span>
                    </span>
                    <img v-else :src="newShoppingItem.image" class="h-full w-full object-contain rounded-xl">
                </label>
            </div>
            <div class="flex space-x-3">
                <button @click="showShoppingModal = false" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm">取消</button>
                <button @click="addShoppingItem" class="flex-1 py-3 rounded-xl bg-deep-sea-blue text-white font-bold text-sm shadow-lg shadow-deep-sea-blue/30">確定</button>
            </div>
        </div>
    </div>

    <!-- Expense Modal -->
    <div v-if="showExpenseModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
            <h3 class="font-bold text-lg mb-5 text-center text-slate-800">新增支出</h3>
            <div class="grid grid-cols-2 gap-3 mb-4">
                <input v-model="newExpense.date" type="date" class="bg-slate-50 rounded-xl p-3 text-sm text-slate-600 outline-none">
                <select v-model="newExpense.category" class="bg-slate-50 rounded-xl p-3 text-sm text-slate-600 outline-none">
                    <option value="food">餐飲</option>
                    <option value="shopping">購物</option>
                    <option value="transport">交通</option>
                    <option value="stay">住宿</option>
                    <option value="ticket">門票</option>
                    <option value="other">其他</option>
                </select>
            </div>
            <input v-model="newExpense.name" placeholder="支出項目" class="w-full bg-slate-50 rounded-xl p-4 mb-4 text-sm outline-none focus:ring-2 focus:ring-accent-yellow">
            <div class="relative mb-4">
                <span class="absolute left-4 top-4 text-slate-400 font-bold">¥</span>
                <input v-model.number="newExpense.amount" type="number" placeholder="0" class="w-full bg-slate-50 rounded-xl p-4 pl-8 text-sm outline-none focus:ring-2 focus:ring-accent-yellow font-bold text-lg">
            </div>
            <div class="flex space-x-3 mb-6">
                <button @click="newExpense.payment = 'cash'" :class="[{ 'bg-deep-sea-blue text-white': newExpense.payment === 'cash' }, 'bg-slate-100 text-slate-500 flex-1 py-3 rounded-xl text-sm transition-colors']">
                    <i class="fa-solid fa-coins mr-1"></i>現金
                </button>
                <button @click="newExpense.payment = 'card'" :class="[{ 'bg-deep-sea-blue text-white': newExpense.payment === 'card' }, 'bg-slate-100 text-slate-500 flex-1 py-3 rounded-xl text-sm transition-colors']">
                    <i class="fa-solid fa-mobile-screen mr-1"></i>電子支付
                </button>
            </div>
            <div class="flex space-x-3">
                <button @click="showExpenseModal = false" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm">取消</button>
                <button @click="addExpense" class="flex-1 py-3 rounded-xl bg-accent-yellow text-white font-bold text-sm shadow-lg shadow-accent-yellow/30">確定</button>
            </div>
        </div>
    </div>

    <!-- Itinerary Modal - Enhanced with Text Color Feature -->
    <div v-if="showItineraryModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
            <h3 class="font-bold text-lg mb-5 text-center text-slate-800">{{ isEditMode ? '編輯行程' : '新增行程' }}</h3>
            
            <!-- Category -->
            <select v-model="newItinerary.category" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none">
                <option value="sightseeing">景點</option>
                <option value="food">餐飲</option>
                <option value="shopping">購物</option>
                <option value="accommodation">住宿</option>
                <option value="flight">航班</option>
                <option value="transport">交通</option>
                <option value="ticket">門票</option>
                <option value="other">其他</option>
            </select>

            <!-- Name -->
            <input v-model="newItinerary.name" placeholder="行程名稱" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-deep-sea-blue">

            <!-- Address -->
            <input v-model="newItinerary.address" placeholder="Google Map地址" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-deep-sea-blue">

            <!-- Time & Transport -->
            <div class="grid grid-cols-2 gap-3">
                <input v-model="newItinerary.startTime" type="text" placeholder="e.g. 09:30" class="bg-slate-50 rounded-xl p-3 text-sm outline-none">
                <select v-model="newItinerary.transportType" class="bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <option value="walk">步行</option>
                    <option value="car">汽車</option>
                    <option value="bus">巴士</option>
                    <option value="public">公共交通</option>
                    <option value="flight">航班</option>
                    <option value="boat">船</option>
                    <option value="other">其他</option>
                </select>
            </div>

            <!-- Travel Time & Hours -->
            <div class="grid grid-cols-2 gap-3">
                <input v-model="newItinerary.travelTime" type="text" placeholder="e.g. 30分">
                <input v-model="newItinerary.hours" type="text" placeholder="e.g. 09:00-17:00">
            </div>

            <!-- Price -->
            <input v-model="newItinerary.price" type="text" placeholder="¥XXX" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-deep-sea-blue">

            <!-- Rich Text Editor with Enhanced Color Features -->
            <div class="w-full bg-slate-50 rounded-xl border border-slate-200 overflow-hidden">
                <!-- Enhanced Toolbar -->
                <div class="rich-editor-toolbar flex flex-col gap-2">
                    <!-- Basic Formatting -->
                    <div class="flex flex-wrap items-center">
                        <button @click.prevent="execCmd('bold')" class="tool-btn" title="粗體"><i class="fa-solid fa-bold"></i></button>
                        <div class="w-px h-5 bg-slate-300 mx-1"></div>
                        <button @click.prevent="execCmd('fontSize', '1')" class="tool-btn" title="小字"><i class="fa-solid fa-font text-[10px]"></i></button>
                        <button @click.prevent="execCmd('fontSize', '3')" class="tool-btn" title="中字"><i class="fa-solid fa-font text-xs"></i></button>
                        <button @click.prevent="execCmd('fontSize', '5')" class="tool-btn" title="大字"><i class="fa-solid fa-font text-lg"></i></button>
                        <div class="w-px h-5 bg-slate-300 mx-1"></div>
                        <button @click.prevent="execCmd('removeFormat')" class="tool-btn" title="清除格式"><i class="fa-solid fa-eraser"></i></button>
                    </div>

                    <!-- Text Color (Enhanced with more colors) -->
                    <div class="flex items-center gap-1.5 overflow-x-auto hide-scrollbar">
                        <span class="text-10px text-slate-400 flex-shrink-0">文字顏色:</span>
                        <span @click.prevent="execCmd('foreColor', '#000000')" class="color-dot bg-black" title="#000000"></span>
                        <span @click.prevent="execCmd('foreColor', '#DC2626')" class="color-dot bg-red-600" title="#DC2626"></span>
                        <span @click.prevent="execCmd('foreColor', '#2563EB')" class="color-dot bg-blue-600" title="#2563EB"></span>
                        <span @click.prevent="execCmd('foreColor', '#059669')" class="color-dot bg-emerald-600" title="#059669"></span>
                        <span @click.prevent="execCmd('foreColor', '#9333EA')" class="color-dot bg-purple-600" title="#9333EA"></span>
                        <span @click.prevent="execCmd('foreColor', '#EA580C')" class="color-dot bg-orange-600" title="#EA580C"></span>
                        <span @click.prevent="execCmd('foreColor', '#57534E')" class="color-dot bg-stone-600" title="#57534E"></span>
                        <span @click.prevent="execCmd('foreColor', '#F59E0B')" class="color-dot bg-amber-500" title="#F59E0B"></span>
                        <span @click.prevent="execCmd('foreColor', '#10B981')" class="color-dot bg-emerald-500" title="#10B981"></span>
                        <span @click.prevent="execCmd('foreColor', '#EF4444')" class="color-dot bg-red-500" title="#EF4444"></span>
                    </div>

                    <!-- Highlight Color -->
                    <div class="flex items-center gap-1.5 overflow-x-auto hide-scrollbar">
                        <span class="text-10px text-slate-400 flex-shrink-0">底色:</span>
                        <span @click.prevent="execCmd('hiliteColor', '#FEF08A')" class="color-dot bg-yellow-200" title="黃色底"></span>
                        <span @click.prevent="execCmd('hiliteColor', '#BAE6FD')" class="color-dot bg-sky-200" title="藍色底"></span>
                        <span @click.prevent="execCmd('hiliteColor', '#BBF7D0')" class="color-dot bg-green-200" title="綠色底"></span>
                        <span @click.prevent="execCmd('hiliteColor', '#FBCFE8')" class="color-dot bg-pink-200" title="粉色底"></span>
                        <span @click.prevent="execCmd('hiliteColor', '#E9D5FF')" class="color-dot bg-purple-200" title="紫色底"></span>
                        <span @click.prevent="execCmd('hiliteColor', 'transparent')" class="color-dot border-dashed border-slate-400 bg-transparent flex items-center justify-center" title="無底色">
                            <i class="fa-solid fa-slash text-8px text-slate-400"></i>
                        </span>
                    </div>
                </div>

                <!-- Editable Content -->
                <div id="noteEditor" contenteditable="true" class="rich-editor-content text-sm" @input="updateNoteContent"></div>
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-3 mt-6">
                <button @click="showItineraryModal = false; isEditMode = false" :class="isEditMode ? 'w-13 flex-1' : 'flex-1'" class="py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm">取消</button>
                <button v-if="isEditMode" @click="removeItineraryItem(newItinerary.id)" class="w-13 py-3 rounded-xl bg-red-100 text-red-600 font-bold text-sm hover:bg-red-200 transition-colors">
                    <i class="fa-solid fa-trash-can mr-1"></i>刪除
                </button>
                <button @click="saveItineraryItem" :class="isEditMode ? 'w-13 flex-1' : 'flex-1'" class="py-3 rounded-xl bg-deep-sea-blue text-white font-bold text-sm shadow-lg shadow-deep-sea-blue/30">確定</button>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted, nextTick } = Vue;
    
    createApp({
        setup() {
            // Constants
            const EXCHANGE_RATE = 1.08;
            
            const CATEGORY_MAP = {
                sightseeing: { color: 'bg-green-600', icon: 'fa-solid fa-camera' },
                food: { color: 'bg-red-600', icon: 'fa-solid fa-bowl-food' },
                shopping: { color: 'bg-indigo-500', icon: 'fa-solid fa-bag-shopping' },
                accommodation: { color: 'bg-purple-600', icon: 'fa-solid fa-bed' },
                flight: { color: 'bg-blue-600', icon: 'fa-solid fa-plane-departure' },
                transport: { color: 'bg-orange-500', icon: 'fa-solid fa-train' },
                ticket: { color: 'bg-cyan-600', icon: 'fa-solid fa-ticket' },
                other: { color: 'bg-slate-500', icon: 'fa-solid fa-circle-info' },
                stay: { color: 'bg-purple-600', icon: 'fa-solid fa-hotel' }
            };
            
            const CATEGORY_LABEL_MAP = {
                sightseeing: '景點',
                food: '餐飲',
                shopping: '購物',
                accommodation: '住宿',
                flight: '航班',
                transport: '交通',
                ticket: '門票',
                other: '其他',
                stay: '住宿'
            };

            // Reactive Data
            const currentTab = ref('itinerary');
            const dates = ref([
                { date: '12/24', weekday: '週一', hasTrain: false, tollFee: 0 },
                { date: '12/25', weekday: '週二', hasTrain: true, tollFee: 0 },
                { date: '12/26', weekday: '週三', hasTrain: true, tollFee: 0 },
                { date: '12/27', weekday: '週四', hasTrain: true, tollFee: 0 },
                { date: '12/28', weekday: '週五', hasTrain: false, tollFee: 0 },
                { date: '12/29', weekday: '週六', hasTrain: true, tollFee: 0 },
                { date: '12/30', weekday: '週日', hasTrain: false, tollFee: 0 },
                { date: '12/31', weekday: '週一', hasTrain: false, tollFee: 0 },
                { date: '1/1', weekday: '週二', hasTrain: false, tollFee: 0 }
            ]);
            
            const hotels = ref([
                { name: '成都酒店', date: '12/24 - 12/27 (3晚)', phone: '', address: '' },
                { name: '重慶酒店A', date: '12/27 - 12/29 (2晚)', phone: '', address: '' },
                { name: '重慶酒店B', date: '12/29 - 1/1 (3晚)', phone: '', address: '' }
            ]);
            
            const itineraryData = ref({
                'Day 1 12/24': [
                    // 原有行程數據保持不變...
                    { id: 101, name: '深圳出發', category: 'transport', startTime: '07:15', address: '', note: '', hours: null, price: null, transportType: 'bus', travelTime: null, isNoteExpanded: false },
                    // ... 其他行程項目
                ],
                // ... 其他日期數據
            });
            
            const weatherData = ref([
                { condition: 'cloudy', temp: '10/5', feel: '3' },
                { condition: 'rain', temp: '9/4', feel: '2' },
                // ... 其他天氣數據
            ]);
            
            const shoppingList = ref([
                { name: '重慶火鍋底料', image: null },
                { name: '熊貓週邊', image: null },
                { name: '成都特產', image: null }
            ]);
            
            const expenses = ref([
                { name: '機票', amount: 2000, category: 'flight', date: '2024-12-14', payment: 'card' },
                { name: '高鐵票', amount: 560, category: 'ticket', date: '2024-12-24', payment: 'card' }
            ]);
            
            const selectedDateIndex = ref(0);
            const showShoppingModal = ref(false);
            const showExpenseModal = ref(false);
            const showItineraryModal = ref(false);
            const isEditMode = ref(false);
            
            const newItinerary = ref({
                id: null, name: '', category: 'sightseeing', startTime: '', hours: '', address: '', price: '', note: '', transportType: 'car', travelTime: '', isNoteExpanded: false
            });
            
            const newShoppingItem = ref({ name: '', image: null });
            const newExpense = ref({ name: '', amount: null, category: 'food', date: new Date().toISOString().substring(0, 10), payment: 'cash' });
            
            const currencyInput = ref(100);
            const currencyResult = ref(0);

            // Computed
            const currentItinerary = computed(() => {
                if (!itineraryData.value[selectedDateIndex.value]) {
                    itineraryData.value[selectedDateIndex.value] = [];
                }
                return itineraryData.value[selectedDateIndex.value];
            });
            
            const totalExpensesCNY = computed(() => {
                return expenses.value.reduce((sum, exp) => sum + exp.amount, 0);
            });
            
            const totalExpensesHKD = computed(() => {
                return Math.round(totalExpensesCNY.value * EXCHANGE_RATE);
            });
            
            const exchangeRate = computed(() => EXCHANGE_RATE);

            // Methods
            const calculateCurrency = () => {
                currencyResult.value = Math.round(currencyInput.value * EXCHANGE_RATE);
            };
            
            const formatNumber = (num) => {
                if (num === 0 || num === null || num === undefined) return '0';
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            };
            
            const formatNoteDisplay = (note) => {
                if (!note) return '<br>';
                // 處理HTML標籤 e.g., <div>, <br>, <b>
                if (note.match(/<[^>]*>/)) return note.replace(/\n/g, '<br>');
                return note.replace(/\n/g, '<br>');
            };
            
            const getCategoryColor = (category) => {
                return CATEGORY_MAP[category]?.color || CATEGORY_MAP.other.color;
            };
            
            const getCategoryIcon = (category) => {
                return CATEGORY_MAP[category]?.icon || CATEGORY_MAP.other.icon;
            };
            
            const getCategoryLabel = (category) => {
                return CATEGORY_LABEL_MAP[category] || category;
            };
            
            const getWeatherIcon = (condition) => {
                const map = {
                    snow: 'fa-solid fa-snowflake',
                    sunny: 'fa-solid fa-sun',
                    cloudy: 'fa-solid fa-cloud',
                    rain: 'fa-solid fa-cloud-showers-heavy'
                };
                return map[condition] || 'fa-solid fa-cloud-question';
            };
            
            const getWeatherDescription = (condition) => {
                const map = {
                    snow: '小雪',
                    sunny: '晴天',
                    cloudy: '多雲',
                    rain: '小雨'
                };
                return map[condition] || '';
            };
            
            const getTransportIcon = (type) => {
                const map = {
                    walk: 'fa-solid fa-shoe-prints',
                    car: 'fa-solid fa-car-side',
                    bus: 'fa-solid fa-bus-simple',
                    public: 'fa-solid fa-train',
                    flight: 'fa-solid fa-plane',
                    boat: 'fa-solid fa-ship',
                    other: 'fa-solid fa-arrow-right-long'
                };
                return map[type] || 'fa-solid fa-arrow-right-long';
            };
            
            const openMap = (query) => {
                if (query) {
                    const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;
                    window.open(url, '_blank');
                }
            };
            
            const openMapDirections = (startItem, endItem) => {
                const origin = `${startItem.address} ${startItem.name}`;
                const destination = `${endItem.address} ${endItem.name}`;
                if (origin && destination) {
                    const url = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(destination)}&travelmode=${endItem.transportType === 'car' ? 'driving' : 'transit'}`;
                    window.open(url, '_blank');
                } else {
                    alert('請先填寫起點和終點地址');
                }
            };
            
            const handleAddClick = () => {
                if (currentTab.value === 'itinerary') {
                    resetItineraryForm();
                    showItineraryModal.value = true;
                } else if (currentTab.value === 'shopping') {
                    resetShoppingForm();
                    showShoppingModal.value = true;
                } else if (currentTab.value === 'expenses') {
                    resetExpenseForm();
                    showExpenseModal.value = true;
                }
            };

            // Enhanced Rich Text Editor Methods
            const execCmd = (command, value = null) => {
                document.execCommand(command, false, value);
            };
            
            const updateNoteContent = (event) => {
                newItinerary.value.note = event.target.innerHTML;
            };
            
            const resetItineraryForm = () => {
                isEditMode.value = false;
                newItinerary.value = {
                    id: Date.now(),
                    name: '',
                    category: 'sightseeing',
                    startTime: '',
                    hours: '',
                    address: '',
                    price: '',
                    note: '',
                    transportType: 'car',
                    travelTime: '',
                    isNoteExpanded: false
                };
                nextTick(() => {
                    const editor = document.getElementById('noteEditor');
                    if (editor) editor.innerHTML = '<br>';
                });
            };
            
            const editItem = (item) => {
                isEditMode.value = true;
                newItinerary.value = JSON.parse(JSON.stringify(item));
                showItineraryModal.value = true;
                nextTick(() => {
                    const editor = document.getElementById('noteEditor');
                    if (editor) {
                        let displayContent = newItinerary.value.note;
                        if (!displayContent.match(/<[^>]*>/)) {
                            displayContent = displayContent.replace(/\n/g, '<br>');
                        }
                        editor.innerHTML = displayContent;
                    }
                });
            };
            
            const saveItineraryItem = () => {
                if (!newItinerary.value.name) {
                    alert('請輸入行程名稱');
                    return;
                }
                
                const editor = document.getElementById('noteEditor');
                if (editor) {
                    newItinerary.value.note = editor.innerHTML;
                }
                
                if (isEditMode.value) {
                    const index = currentItinerary.value.findIndex(item => item.id === newItinerary.value.id);
                    if (index !== -1) {
                        currentItinerary.value[index] = { ...newItinerary.value };
                    }
                } else {
                    const newItem = { ...newItinerary.value };
                    newItem.id = Date.now();
                    itineraryData.value[selectedDateIndex.value].push(newItem);
                    itineraryData.value[selectedDateIndex.value] = [...currentItinerary.value];
                }
                
                showItineraryModal.value = false;
                isEditMode.value = false;
            };
            
            const removeItineraryItem = (id) => {
                if (confirm('確定要刪除此行程嗎？')) {
                    const currentList = itineraryData.value[selectedDateIndex.value];
                    const index = currentList.findIndex(item => item.id === id);
                    if (index !== -1) {
                        currentList.splice(index, 1);
                        itineraryData.value[selectedDateIndex.value] = [...currentList];
                    }
                    showItineraryModal.value = false;
                    isEditMode.value = false;
                }
            };
            
            const moveItinerary = (id, direction) => {
                const currentList = [...currentItinerary.value];
                const index = currentList.findIndex(item => item.id === id);
                if (index === -1) return;
                
                const newIndex = index + direction;
                if (newIndex < 0) newIndex = currentList.length - 1;
                if (newIndex >= currentList.length) newIndex = 0;
                
                const item = currentList.splice(index, 1)[0];
                currentList.splice(newIndex, 0, item);
                itineraryData.value[selectedDateIndex.value] = currentList;
            };
            
            const moveItineraryUp = (id) => moveItinerary(id, -1);
            const moveItineraryDown = (id) => moveItinerary(id, 1);

            // Shopping Methods
            const resetShoppingForm = () => {
                newShoppingItem.value = { name: '', image: null };
            };
            
            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        newShoppingItem.value.image = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            const addShoppingItem = () => {
                if (newShoppingItem.value.name.trim()) {
                    shoppingList.value.push({ ...newShoppingItem.value });
                    showShoppingModal.value = false;
                    resetShoppingForm();
                } else {
                    alert('請輸入購物項目名稱');
                }
            };
            
            const removeShoppingItem = (index) => {
                shoppingList.value.splice(index, 1);
            };

            // Expense Methods
            const resetExpenseForm = () => {
                newExpense.value = {
                    name: '',
                    amount: null,
                    category: 'food',
                    date: new Date().toISOString().substring(0, 10),
                    payment: 'cash'
                };
            };
            
            const addExpense = () => {
                if (!newExpense.value.name.trim()) {
                    alert('請輸入支出項目名稱');
                    return;
                }
                if (newExpense.value.amount === null || newExpense.value.amount === 0) {
                    alert('請輸入支出金額');
                    return;
                }
                expenses.value.push({ ...newExpense.value });
                expenses.value.sort((a, b) => new Date(b.date) - new Date(a.date));
                showExpenseModal.value = false;
                resetExpenseForm();
            };
            
            const removeExpense = (index) => {
                expenses.value.splice(index, 1);
            };

            // Lifecycle
            onMounted(() => {
                calculateCurrency();
                expenses.value.sort((a, b) => new Date(b.date) - new Date(a.date));
            });

            return {
                currentTab, dates, selectedDateIndex, itineraryData, currentItinerary, hotels, shoppingList, expenses,
                totalExpensesCNY, totalExpensesHKD, exchangeRate, weatherData, currencyInput, currencyResult,
                calculateCurrency, formatNumber, getCategoryColor, getCategoryIcon, getCategoryLabel,
                getWeatherIcon, getTransportIcon, getWeatherDescription, showShoppingModal, showExpenseModal,
                showItineraryModal, isEditMode, newShoppingItem, newExpense, newItinerary, handleAddClick,
                handleImageUpload, addShoppingItem, removeShoppingItem, addExpense, removeExpense, editItem,
                saveItineraryItem, removeItineraryItem, moveItineraryUp, moveItineraryDown, openMap, openMapDirections,
                execCmd, updateNoteContent, formatNoteDisplay
            };
        }
    }).mount('#app');
</script>
</body>
</html>

